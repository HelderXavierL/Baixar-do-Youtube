import yt_dlp
import os

output_folder = "Pasta de despejo"
os.makedirs(output_folder, exist_ok=True)

url = input("Cole o link do vídeo ou playlist: ").strip()

while True:
    escolha = input("Deseja baixar como MP4 (vídeo) ou MP3 (áudio)? Digite MP4 ou MP3: ").strip().upper()
    if escolha in ["MP4", "MP3"]:
        break
    print("Opção inválida! Digite apenas MP4 ou MP3.")

if escolha == "MP4":
    ydl_opts = {
        'format': 'bestvideo[ext=mp4]+bestaudio[ext=m4a]/mp4',  # força formatos compatíveis
        'outtmpl': f'{output_folder}/%(title)s.%(ext)s',
        'merge_output_format': 'mp4',  # mescla vídeo + áudio em mp4
    }
else:  # MP3
    ydl_opts = {
        'format': 'bestaudio/best',
        'outtmpl': f'{output_folder}/%(title)s.%(ext)s',
        'postprocessors': [
            {
                'key': 'FFmpegExtractAudio',
                'preferredcodec': 'mp3',
                'preferredquality': '192',
            }
        ],
    }

with yt_dlp.YoutubeDL(ydl_opts) as ydl:
    ydl.download([url])

print("Download concluído!")
